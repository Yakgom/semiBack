<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="employeeMapper">
  
  <sql id="employeeColumn">
  	SELECT 
	       EMP_ID empId
	     , EMP_NAME empName
	     , SALARY 
	     , DEPT_TITLE detpCode
	     , JOB_NAME jobCode
	  FROM
	       EMPLOYEE
	  JOIN
	       DEPARTMENT ON DEPT_ID = DEPT_CODE
	  JOIN
	  		 JOB
	       USING (JOB_CODE)
  </sql>
  <sql id="findByColumn">
  SELECT
	       EMP_ID empId
	     , EMP_NAME empName
	     , EMP_NO empNo
	     , EMAIL
	     , PHONE
	     , DEPT_CODE detpCode
	     , JOB_CODE jobCode
	     , SAL_LEVEL salLevel
	     , SALARY
	     , BONUS
	     , MANAGER_ID managerId
	     , HIRE_DATE hireDate
	     , ENT_DATE entDate
	     , ENT_YN  entYn
	  FROM
	       EMPLOYEE
  </sql>
  
  <select id="findAll" resultType="employee">
  		<include refid="employeeColumn"></include>
  	   WHERE
	         ENT_YN = 'N'      
	   ORDER     
	 	  BY
	 	     EMP_ID  DESC
  
  </select>
  
  <select id="findByDept" resultType="employee"
  parameterType="string"
  >
  
  <include refid="employeeColumn" />
  	WHERE
	       DEPT_TITLE = #{deptTitle}
	 ORDER     
	 	BY
	 	    EMP_ID  DESC
  
  
  </select>
  
  <select id="findByJob" parameterType="string" resultType="employee">
  <include refid="employeeColumn" />
 	WHERE
	       JOB_NAME = #{jobName}
	 ORDER     
	 	BY
	 	    EMP_ID  	
  </select>
  
  <select id="findById" parameterType="string"
  resultType="employee"
  >
  <include refid="findByColumn"></include>
	 WHERE
	       EMP_ID = #{empId}
	 ORDER     
	 	BY
	 	   EMP_ID  
  
  
  </select>
  
  <select id="findByHighSalary" resultType="employee">
  <include refid="findByColumn"></include>
	 ORDER     
	    BY
	       SALARY DESC NULLS LAST 
	OFFSET 
	       0 ROWS  FETCH NEXT 5 ROWS ONLY
  </select>
  
  <select id="findByLowSalary" resultType="employee">
  <include refid="findByColumn"></include>
   ORDER     
	    BY
	       SALARY ASC NULLS LAST 
	OFFSET 
	       0 ROWS  FETCH NEXT 5 ROWS ONLY
  
  
  </select>
  
  <insert id="save" parameterType="Employee" >
    INSERT
	  INTO
	       EMPLOYEE
	       (
	       EMP_ID 
	     , EMP_NAME 
	     , EMP_NO
	     , EMAIL
	     , PHONE
	     , DEPT_CODE
	     , JOB_CODE 
	     , SAL_LEVEL 
	     , SALARY
	     , BONUS
	     , MANAGER_ID
	     , HIRE_DATE
	       )
	VALUES
	       (
	       SEQ_EMPID.NEXTVAL
	     , #{empName}
	     , #{empNo}
	     , #{email}
	     , #{phone}
	     , #{detpCode}
	     , #{jobCode}
	     , #{salLevel}
	     , #{salary}
	     , #{bonus}
	     , #{managerId}
	     , SYSDATE
	       )
  </insert>
  
<update id="update" parameterType="EmployeeDTO">
    UPDATE EMPLOYEE E
       SET E.JOB_CODE = (
            SELECT J.JOB_CODE 
              FROM JOB J
             WHERE J.JOB_NAME = #{jobName}
       ),
           E.DEPT_CODE = (
            SELECT D.DEPT_ID 
              FROM DEPARTMENT D
             WHERE D.DEPT_TITLE = #{deptName}
       )
     WHERE E.EMP_ID = #{empId}
</update>

<delete id="delete" parameterType="string">
	UPDATE
	       EMPLOYEE
	   SET
	       ENT_YN = 'Y'
	     , ENT_DATE = SYSDATE
	 WHERE
	       EMP_ID = #{empId}
</delete>
  
  </mapper>